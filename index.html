<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Minimal Tasks v38</title>
  <meta name="theme-color" content="#0ea5e9">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <style>
    :root{--bg:#0b1220;--fg:#e6eefc;--card:#111a33;--muted:#93a4bf;--accent:#0ea5e9;--line:rgba(255,255,255,.12)}
    @media (prefers-color-scheme:light){:root{--bg:#f6f8fc;--fg:#0b1220;--card:#fff;--muted:#5b6b86;--accent:#0ea5e9;--line:rgba(0,0,0,.12)}}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--fg)}
    header{position:sticky;top:0;background:rgba(0,0,0,.2);backdrop-filter:blur(6px);padding:12px 16px;border-bottom:1px solid var(--line);z-index:5}
    h1{margin:0;font-size:18px}
    main{max-width:820px;margin:0 auto;padding:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px}
    form.add{display:grid;grid-template-columns:1fr auto;gap:8px;margin-bottom:10px}
    input[type="text"]{padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:rgba(255,255,255,.05);color:var(--fg);outline:none}
    input[type="text"]:focus{border-color:var(--accent);box-shadow:0 0 0 4px rgba(14,165,233,.25)}
    button{border:none;background:var(--accent);color:#fff;border-radius:10px;padding:10px 12px;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid var(--line);color:var(--fg)}
    ul{list-style:none;padding:0;margin:0;display:grid;gap:8px}
    li.row{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:rgba(255,255,255,.03);position:relative}
    .row .title{min-width:0;word-break:break-word}
    .actions{display:flex;gap:6px;position:relative;z-index:3}
    .row input[type="checkbox"]{width:18px;height:18px;position:relative;z-index:3}
    a.row-link{position:absolute;inset:0;border-radius:12px;color:inherit;text-decoration:none;z-index:1}
    .muted{color:var(--muted);font-size:13px}
    .breadcrumbs{margin-bottom:8px}
    .breadcrumbs a{color:inherit;text-decoration:none;opacity:.85}
    textarea{width:100%;min-height:160px;padding:12px;border-radius:10px;border:1px solid var(--line);background:rgba(255,255,255,.05);color:var(--fg)}
    .note-thumb{max-width:96px;max-height:96px;border-radius:8px;border:1px solid var(--line)}
    .note-thumb-wrap{position:relative;display:inline-block}
    .note-del{position:absolute;top:4px;right:4px;background:#e11d48;color:#fff;border:none;border-radius:8px;padding:2px 6px;font-size:12px}
    /* confirm modal */
    #confirmModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:200}
    #confirmModal .box{background:var(--card);padding:20px;border-radius:12px;max-width:320px;width:90%;box-shadow:0 6px 30px rgba(0,0,0,.45);display:grid;gap:14px}
    /* pdf choice modal */
    #pdfChoiceModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:210}
    #pdfChoiceModal .box{background:var(--card);padding:20px;border-radius:12px;max-width:360px;width:92%;box-shadow:0 6px 30px rgba(0,0,0,.45);display:grid;gap:14px}
  </style>
</head>
<body>
  <header><h1 id="appTitle">Minimal Tasks v38</h1></header>
  <main>
    <!-- List -->
    <section id="view-list" class="card" hidden>
      <form id="addTask" class="add" autocomplete="off">
        <input id="taskTitle" type="text" maxlength="120" placeholder="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞‚Ä¶" required>
        <button>–î–æ–±–∞–≤–∏—Ç—å</button>
      </form>
      <ul id="tasks" class="tasks"></ul>
      <p id="tasksEmpty" class="muted" hidden>–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç.</p>
    </section>

    <!-- Detail -->
    <section id="view-detail" class="card" hidden>
      <div class="breadcrumbs"><a href="#/">‚Üê –ó–∞–¥–∞—á–∏</a></div>
      <div class="muted" id="taskHeader"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 10px;">
        <button id="pdfBtn" class="ghost">PDF</button>
        <button id="renameTaskBtn" class="ghost">‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>
        <button id="deleteTaskBtn" class="ghost" style="border-color:#e11d48;color:#e11d48">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É</button>
      </div>
      <form id="addSub" class="add" autocomplete="off">
        <input id="subTitle" type="text" maxlength="160" placeholder="–ù–æ–≤–∞—è –ø–æ–¥–∑–∞–¥–∞—á–∞‚Ä¶" required>
        <button>–î–æ–±–∞–≤–∏—Ç—å</button>
      </form>
      <ul id="checkList" class="check"></ul>
      <p id="emptyCheck" class="muted" hidden>–ü–æ–¥–∑–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    </section>

    <!-- Note -->
    <section id="view-note" class="card" hidden>
      <nav class="breadcrumbs">
        <a href="#/">‚Üê –°–ø–∏—Å–æ–∫</a> / <a id="crumbTask" href="#">–ó–∞–¥–∞—á–∞</a> / <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</strong>
      </nav>
      <div style="display:grid;gap:10px;">
        <div><div class="muted">–ü–æ–¥–∑–∞–¥–∞—á–∞</div><div id="noteSubtaskText" style="font-weight:600;"></div></div>
        <label for="noteText" class="muted">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
        <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
          <button id="noteAttachBtn" class="ghost">üìé –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
          <input id="noteAttachInput" type="file" accept="image/*" capture="environment" style="display:none;">
          <div id="notePhotos" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
        </div>
        <textarea id="noteText" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É‚Ä¶"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end;">
          <button id="saveNoteBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Confirm modal -->
  <div id="confirmModal">
    <div class="box">
      <div id="confirmText">–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å?</div>
      <div style="display:flex;gap:10px;justify-content:flex-end;">
        <button id="confirmCancel" class="ghost">–û—Ç–º–µ–Ω–∞</button>
        <button id="confirmOk" style="background:#e11d48;">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- PDF Choice Modal -->
  <div id="pdfChoiceModal">
    <div class="box">
      <div style="font-weight:700">–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF</div>
      <div style="display:grid;gap:10px;">
        <button id="optChecklist" class="ghost" style="display:flex;gap:10px;align-items:center;justify-content:flex-start;padding:12px;border-radius:10px;">
          <span>‚úÖ</span><div><div style="font-weight:600">–ß–µ–∫‚Äë–ª–∏—Å—Ç</div><div class="muted" style="font-size:12px">—Ç–∞–±–ª–∏—Ü–∞ —Å –¥–∞—Ç–∞–º–∏</div></div>
        </button>
        <button id="optDescription" class="ghost" style="display:flex;gap:10px;align-items:center;justify-content:flex-start;padding:12px;border-radius:10px;">
          <span>üìù</span><div><div style="font-weight:600">–û–ø–∏—Å–∞–Ω–∏–µ</div><div class="muted" style="font-size:12px">–ø–æ–¥–∑–∞–¥–∞—á–∏ + –ø—Ä–∏–º–µ—á–∞–Ω–∏—è + —Ñ–æ—Ç–æ</div></div>
        </button>
      </div>
      <div style="display:flex;justify-content:flex-end;">
        <button id="pdfChoiceCancel" class="ghost">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <script src="app.js?v=38"></script>
</body>
</html>
